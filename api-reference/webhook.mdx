---
title: 'Webhooks'
description: 'Receive real-time notifications for validation events'
---

## Overview

Webhooks allow you to receive real-time HTTP POST notifications when validation events occur. Configure webhook endpoints in your dashboard to get instant updates for successful validations, blocked attempts, and security events.

<Note>
  Webhooks are sent from Vouch's servers to your endpoint. Ensure your endpoint is publicly accessible and can handle POST requests.
</Note>

## Setup

### 1. Configure Webhook URL

In your Vouch dashboard:
1. Navigate to **Project Settings → Webhooks**
2. Click **Add Webhook Endpoint**
3. Enter your webhook URL (must be HTTPS in production)
4. Select which events to receive
5. Save your webhook configuration

### 2. Verify Webhook Signature

All webhook requests include a signature header for verification:

```javascript
const crypto = require('crypto');

function verifyWebhookSignature(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(JSON.stringify(payload))
    .digest('hex');

  return signature === expectedSignature;
}

// Express.js example
app.post('/webhooks/vouch', express.json(), (req, res) => {
  const signature = req.headers['x-vouch-signature'];
  const secret = process.env.VOUCH_WEBHOOK_SECRET;

  if (!verifyWebhookSignature(req.body, signature, secret)) {
    return res.status(401).json({ error: 'Invalid signature' });
  }

  // Process webhook
  const event = req.body;
  console.log('Received event:', event.type);

  res.status(200).json({ received: true });
});
```

## Webhook Events

### validation.completed

Sent when an email validation completes successfully.

```json
{
  "id": "evt_1234567890",
  "type": "validation.completed",
  "created": 1704067200,
  "data": {
    "validationId": "val_abc123xyz",
    "projectId": "proj_your_project",
    "email": "user@example.com",
    "valid": true,
    "recommendation": "allow",
    "signals": {
      "syntax": { "valid": true },
      "disposable": { "isDisposable": false },
      "mx": { "valid": true, "records": ["mx1.example.com"] },
      "smtp": { "deliverable": true },
      "fingerprint": {
        "visitorId": "abc123...",
        "confidence": 0.95
      }
    },
    "metadata": {
      "ipAddress": "203.0.113.1",
      "userAgent": "Mozilla/5.0...",
      "country": "US"
    },
    "timestamp": "2024-01-01T00:00:00Z"
  }
}
```

### validation.blocked

Sent when a validation is blocked due to fraud or security concerns.

```json
{
  "id": "evt_1234567891",
  "type": "validation.blocked",
  "created": 1704067200,
  "data": {
    "validationId": "val_xyz789abc",
    "projectId": "proj_your_project",
    "email": "suspicious@tempmail.com",
    "valid": false,
    "recommendation": "block",
    "reasons": [
      "disposable_email",
      "suspicious_ip"
    ],
    "signals": {
      "syntax": { "valid": true },
      "disposable": { "isDisposable": true, "provider": "tempmail.com" },
      "mx": { "valid": true },
      "fingerprint": {
        "visitorId": "xyz789...",
        "confidence": 0.45,
        "suspiciousActivity": true
      }
    },
    "metadata": {
      "ipAddress": "198.51.100.1",
      "userAgent": "curl/7.68.0",
      "country": "XX",
      "threat": "Known fraud IP"
    },
    "timestamp": "2024-01-01T00:05:00Z"
  }
}
```

### validation.flagged

Sent when a validation is flagged for manual review.

```json
{
  "id": "evt_1234567892",
  "type": "validation.flagged",
  "created": 1704067200,
  "data": {
    "validationId": "val_flag456",
    "projectId": "proj_your_project",
    "email": "admin@example.com",
    "valid": true,
    "recommendation": "flag",
    "reasons": [
      "role_email",
      "new_device"
    ],
    "signals": {
      "syntax": { "valid": true },
      "disposable": { "isDisposable": false },
      "mx": { "valid": true },
      "role": { "isRole": true, "type": "admin" },
      "fingerprint": {
        "visitorId": "new123...",
        "confidence": 0.82,
        "firstSeen": true
      }
    },
    "metadata": {
      "ipAddress": "192.0.2.1",
      "userAgent": "Mozilla/5.0...",
      "country": "CA"
    },
    "timestamp": "2024-01-01T00:10:00Z"
  }
}
```

### fingerprint.suspicious

Sent when suspicious device fingerprint activity is detected.

```json
{
  "id": "evt_1234567893",
  "type": "fingerprint.suspicious",
  "created": 1704067200,
  "data": {
    "validationId": "val_sus789",
    "projectId": "proj_your_project",
    "visitorId": "suspicious123...",
    "reasons": [
      "fingerprint_spoofing",
      "bot_detected"
    ],
    "details": {
      "confidence": 0.23,
      "inconsistencies": [
        "Canvas fingerprint mismatch",
        "WebGL renderer spoofed"
      ],
      "botScore": 0.89
    },
    "metadata": {
      "ipAddress": "203.0.113.50",
      "userAgent": "HeadlessChrome/91.0.4472.124",
      "country": "US"
    },
    "timestamp": "2024-01-01T00:15:00Z"
  }
}
```

## Webhook Headers

All webhook requests include these headers:

<ParamField header="X-Vouch-Signature" type="string">
  HMAC SHA-256 signature of the request body using your webhook secret
</ParamField>

<ParamField header="X-Vouch-Event-Id" type="string">
  Unique identifier for this webhook event
</ParamField>

<ParamField header="X-Vouch-Event-Type" type="string">
  Type of event (e.g., `validation.completed`)
</ParamField>

<ParamField header="X-Vouch-Timestamp" type="number">
  Unix timestamp when the event was created
</ParamField>

<ParamField header="Content-Type" type="string">
  Always `application/json`
</ParamField>

## Implementing a Webhook Handler

### Node.js/Express

```javascript
const express = require('express');
const crypto = require('crypto');

const app = express();

// IMPORTANT: Use raw body for signature verification
app.post('/webhooks/vouch',
  express.json({
    verify: (req, res, buf) => {
      req.rawBody = buf.toString();
    }
  }),
  async (req, res) => {
    const signature = req.headers['x-vouch-signature'];
    const eventId = req.headers['x-vouch-event-id'];

    // Verify signature
    const expectedSignature = crypto
      .createHmac('sha256', process.env.VOUCH_WEBHOOK_SECRET)
      .update(req.rawBody)
      .digest('hex');

    if (signature !== expectedSignature) {
      console.error('Invalid webhook signature');
      return res.status(401).json({ error: 'Invalid signature' });
    }

    // Check for duplicate events
    const isDuplicate = await checkEventProcessed(eventId);
    if (isDuplicate) {
      return res.status(200).json({ received: true });
    }

    // Process event
    const event = req.body;

    try {
      await handleWebhookEvent(event);
      await markEventProcessed(eventId);

      res.status(200).json({ received: true });
    } catch (error) {
      console.error('Error processing webhook:', error);
      res.status(500).json({ error: 'Processing failed' });
    }
  }
);

async function handleWebhookEvent(event) {
  switch (event.type) {
    case 'validation.completed':
      console.log('Validation completed:', event.data.email);
      // Update your database, send notifications, etc.
      break;

    case 'validation.blocked':
      console.warn('Validation blocked:', event.data.email);
      // Log security event, alert team, etc.
      break;

    case 'validation.flagged':
      console.log('Validation flagged:', event.data.email);
      // Queue for manual review
      break;

    case 'fingerprint.suspicious':
      console.warn('Suspicious fingerprint:', event.data.visitorId);
      // Enhance security measures
      break;

    default:
      console.log('Unknown event type:', event.type);
  }
}

// Store processed event IDs to prevent duplicates
const processedEvents = new Set();

async function checkEventProcessed(eventId) {
  return processedEvents.has(eventId);
}

async function markEventProcessed(eventId) {
  processedEvents.add(eventId);
  // In production, store in a database with TTL
}

app.listen(3000, () => {
  console.log('Webhook server running on port 3000');
});
```

### Next.js API Route

```typescript app/api/webhooks/vouch/route.ts
import { NextRequest, NextResponse } from 'next/server';
import crypto from 'crypto';

export async function POST(request: NextRequest) {
  const signature = request.headers.get('x-vouch-signature');
  const eventId = request.headers.get('x-vouch-event-id');

  if (!signature || !eventId) {
    return NextResponse.json(
      { error: 'Missing headers' },
      { status: 400 }
    );
  }

  // Get raw body for signature verification
  const body = await request.text();
  const event = JSON.parse(body);

  // Verify signature
  const expectedSignature = crypto
    .createHmac('sha256', process.env.VOUCH_WEBHOOK_SECRET!)
    .update(body)
    .digest('hex');

  if (signature !== expectedSignature) {
    return NextResponse.json(
      { error: 'Invalid signature' },
      { status: 401 }
    );
  }

  // Process event
  try {
    await handleWebhookEvent(event);

    return NextResponse.json({ received: true });
  } catch (error) {
    console.error('Webhook processing error:', error);
    return NextResponse.json(
      { error: 'Processing failed' },
      { status: 500 }
    );
  }
}

async function handleWebhookEvent(event: any) {
  switch (event.type) {
    case 'validation.completed':
      // Handle successful validation
      break;
    case 'validation.blocked':
      // Handle blocked validation
      break;
    // ... other cases
  }
}
```

### Python/Flask

```python
from flask import Flask, request, jsonify
import hmac
import hashlib
import os

app = Flask(__name__)

@app.route('/webhooks/vouch', methods=['POST'])
def vouch_webhook():
    signature = request.headers.get('X-Vouch-Signature')
    event_id = request.headers.get('X-Vouch-Event-Id')

    if not signature or not event_id:
        return jsonify({'error': 'Missing headers'}), 400

    # Verify signature
    secret = os.environ.get('VOUCH_WEBHOOK_SECRET').encode()
    body = request.get_data()

    expected_signature = hmac.new(
        secret,
        body,
        hashlib.sha256
    ).hexdigest()

    if signature != expected_signature:
        return jsonify({'error': 'Invalid signature'}), 401

    # Check for duplicates
    if is_event_processed(event_id):
        return jsonify({'received': True}), 200

    # Process event
    event = request.get_json()

    try:
        handle_webhook_event(event)
        mark_event_processed(event_id)

        return jsonify({'received': True}), 200
    except Exception as e:
        print(f'Error processing webhook: {e}')
        return jsonify({'error': 'Processing failed'}), 500

def handle_webhook_event(event):
    event_type = event.get('type')

    if event_type == 'validation.completed':
        print(f"Validation completed: {event['data']['email']}")
    elif event_type == 'validation.blocked':
        print(f"Validation blocked: {event['data']['email']}")
    elif event_type == 'validation.flagged':
        print(f"Validation flagged: {event['data']['email']}")
    elif event_type == 'fingerprint.suspicious':
        print(f"Suspicious fingerprint: {event['data']['visitorId']}")

if __name__ == '__main__':
    app.run(port=3000)
```

## Testing Webhooks

### Local Development

Use a tunneling service like ngrok to expose your local server:

```bash
# Start ngrok
ngrok http 3000

# Use the ngrok URL in your dashboard
https://abc123.ngrok.io/webhooks/vouch
```

### Manual Testing

Send a test webhook from your dashboard:

1. Go to **Project Settings → Webhooks**
2. Click **Send Test Event** next to your webhook
3. Select an event type
4. Click **Send**

### Webhook Logs

View webhook delivery logs in your dashboard:
- Delivery status (success/failed)
- Response codes
- Response times
- Retry attempts

## Retry Logic

Vouch automatically retries failed webhook deliveries:

- **Immediate retry**: After 1 second
- **2nd retry**: After 5 seconds
- **3rd retry**: After 30 seconds
- **4th retry**: After 5 minutes
- **5th retry**: After 1 hour

<Warning>
  After 5 failed attempts, the webhook delivery is marked as failed and will not be retried. Check your webhook logs in the dashboard.
</Warning>

## Best Practices

### 1. Respond Quickly

Respond with 200 OK as soon as you receive the webhook:

```javascript
// ✓ Good - Process asynchronously
app.post('/webhooks/vouch', async (req, res) => {
  const event = req.body;

  // Respond immediately
  res.status(200).json({ received: true });

  // Process asynchronously
  processWebhookAsync(event);
});

// ✗ Bad - Slow response
app.post('/webhooks/vouch', async (req, res) => {
  const event = req.body;

  // This might take too long
  await complexProcessing(event);

  res.status(200).json({ received: true });
});
```

### 2. Handle Duplicates

Implement idempotency by tracking processed event IDs:

```javascript
const processedEvents = new Set();

async function isEventProcessed(eventId) {
  // Check database or cache
  return processedEvents.has(eventId);
}

async function markEventProcessed(eventId) {
  processedEvents.add(eventId);
  // Store in database with 24-hour TTL
}
```

### 3. Verify Signatures

Always verify webhook signatures to prevent spoofing:

```javascript
function verifySignature(body, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(body)
    .digest('hex');

  // Use timing-safe comparison
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}
```

### 4. Handle Errors Gracefully

Return appropriate status codes:

```javascript
try {
  await processWebhook(event);
  res.status(200).json({ received: true });
} catch (error) {
  if (error.isRetryable) {
    // 5xx errors trigger retries
    res.status(500).json({ error: 'Temporary failure' });
  } else {
    // 4xx errors don't trigger retries
    res.status(400).json({ error: 'Invalid event' });
  }
}
```

### 5. Monitor Webhook Health

Set up monitoring for webhook failures:

```javascript
app.post('/webhooks/vouch', async (req, res) => {
  try {
    await processWebhook(req.body);

    // Log success
    metrics.increment('webhook.success');

    res.status(200).json({ received: true });
  } catch (error) {
    // Log failure
    metrics.increment('webhook.failure');
    logger.error('Webhook processing failed', { error, event: req.body });

    res.status(500).json({ error: 'Processing failed' });
  }
});
```

## Security Considerations

1. **Use HTTPS**: Always use HTTPS endpoints in production
2. **Verify Signatures**: Never skip signature verification
3. **Validate Event Data**: Sanitize and validate all webhook data
4. **Rate Limiting**: Implement rate limiting on your webhook endpoint
5. **IP Allowlisting**: Optionally restrict requests to Vouch's IP ranges

## Webhook IP Ranges

Webhooks are sent from these IP ranges:

```
52.89.214.238
34.212.75.30
54.218.53.128
52.32.178.7
```

You can optionally restrict your webhook endpoint to these IPs.

## Troubleshooting

### Webhooks Not Received

1. Check webhook configuration in dashboard
2. Verify endpoint is publicly accessible
3. Check firewall/security group settings
4. Review webhook logs in dashboard

### Signature Verification Fails

1. Ensure you're using the raw request body
2. Check webhook secret is correct
3. Verify HMAC implementation
4. Check for character encoding issues

### Timeouts

1. Respond within 10 seconds
2. Process webhooks asynchronously
3. Increase timeout limits if needed

## Support

For webhook issues:
- **Dashboard Logs**: Check webhook delivery logs
- **Email**: support@vouch.expert
- **Documentation**: docs.vouch.expert/api-reference/webhook
